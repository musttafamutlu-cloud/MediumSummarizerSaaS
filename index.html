<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Medium Summarizer â€” AI SaaS</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    body {
        background: linear-gradient(135deg, #0f172a, #1e293b);
        font-family: "Inter", sans-serif;
        padding: 50px;
        color: #e2e8f0;
    }

    .container {
        max-width: 900px;
        margin: auto;
        padding: 35px;
        background: rgba(255,255,255,0.05);
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 24px;
        backdrop-filter: blur(18px);
        box-shadow:
            0 0 25px rgba(255,255,255,0.08),
            inset 0 0 35px rgba(255,255,255,0.02);
    }

    h1 {
        text-align: center;
        font-size: 42px;
        margin-bottom: 35px;
        font-weight: 700;
        background: linear-gradient(90deg, #60a5fa, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    h3 {
        font-size: 20px;
        margin-top: 25px;
        margin-bottom: 12px;
        font-weight: 600;
        color: #cbd5e1;
    }

    input {
        width: 100%;
        padding: 18px;
        font-size: 16px;
        border-radius: 15px;
        border: none;
        background: rgba(255,255,255,0.12);
        color: #fff;
        outline: none;
        transition: 0.25s;
        backdrop-filter: blur(6px);
    }

    input:focus {
        box-shadow: 0 0 0 3px rgba(96,165,250,0.5);
    }

    button {
        margin-top: 15px;
        padding: 14px 26px;
        background: linear-gradient(135deg, #3b82f6, #6366f1);
        border: none;
        border-radius: 14px;
        color: white;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 25px rgba(99,102,241,0.4);
    }

    .card {
        margin-top: 22px;
        background: rgba(255,255,255,0.08);
        padding: 22px;
        border-radius: 18px;
        border: 1px solid rgba(255,255,255,0.1);
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    }

    .id-tag {
        font-size: 12px;
        opacity: 0.7;
        margin-bottom: 5px;
    }

    pre {
        background: rgba(255,255,255,0.06);
        padding: 15px;
        border-radius: 12px;
        line-height: 1.6;
        font-size: 14px;
        color: #f1f5f9;
        border: 1px solid rgba(255,255,255,0.08);
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }

    .actions button {
        padding: 10px 18px;
        margin-right: 10px;
        border-radius: 10px;
        font-size: 13px;
    }

    .copy-btn {
        background: #3b82f6;
    }

    .delete-btn {
        background: #ef4444;
    }

    hr {
        border: none;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        margin: 40px 0;
    }
</style>
</head>

<body>

<div class="container">

    <h1>Medium Article Summarizer</h1>

    <h3>Enter Medium URL</h3>
    <input id="urlInput" placeholder="https://medium.com/..." />
    <button onclick="summarize()">Summarize</button>

    <!-- Latest Summary -->
    <div id="latestSummaryCard" class="card" style="display:none;">
        <div class="id-tag">Latest Summary</div>
        <p><b>URL:</b> <span id="latestUrl"></span></p>

        <p><b>Summary:</b></p>
        <pre id="latestSummaryText"></pre>

        <button class="copy-btn" onclick="copyLatest()">Copy</button>
    </div>

    <hr>

    <h3>Your Summary History</h3>
    <button onclick="loadHistory()">Refresh</button>

    <div id="history"></div>

</div>

<script>
const API = "http://127.0.0.1:8000";

//
// SUMMARIZE
//
async function summarize() {
    const url = document.getElementById("urlInput").value;
    if (!url) return alert("Please enter a Medium URL.");

    try {
        const res = await fetch(`${API}/api/summarize`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ url })
        });

        const data = await res.json();

        if (!res.ok) {
            alert("Error: " + (data.detail || "Unknown error"));
            return;
        }

        document.getElementById("latestUrl").textContent = data.url;
        document.getElementById("latestSummaryText").textContent = data.summary;
        document.getElementById("latestSummaryCard").style.display = "block";

        loadHistory();
        alert("Summary created!");

    } catch (err) {
        alert("Unexpected error: " + err);
    }
}

//
// LOAD HISTORY
//
async function loadHistory() {
    try {
        const res = await fetch(`${API}/api/history`);
        const list = await res.json();

        const box = document.getElementById("history");
        box.innerHTML = "";

        list.forEach(item => {
            box.innerHTML += `
            <div class="card">
                <div class="id-tag">ID: ${item.id}</div>
                <p><b>URL:</b> ${item.original_url}</p>
                <p><b>Preview:</b> ${item.summary_text.substring(0,150)}...</p>

                <div class="actions">
                    <button class="copy-btn"
                        onclick="copyText(\`${escapeBackticks(item.summary_text)}\`)">Copy</button>

                    <button class="delete-btn"
                        onclick="deleteSummary(${item.id})">Delete</button>
                </div>
            </div>`;
        });

    } catch (err) {
        alert("Failed to load history.");
    }
}

//
// DELETE SUMMARY
//
async function deleteSummary(id) {
    try {
        const res = await fetch(`${API}/api/history/${id}`, {
            method: "DELETE"
        });

        if (!res.ok) return alert("Delete failed.");
        loadHistory();

    } catch (err) {
        alert("Error: " + err);
    }
}

function escapeBackticks(str) {
    return str.replace(/`/g, "\\`");
}

function copyLatest() {
    const text = document.getElementById("latestSummaryText").textContent;
    navigator.clipboard.writeText(text);
    alert("Copied!");
}

function copyText(text) {
    navigator.clipboard.writeText(text);
    alert("Copied!");
}

//
// auto load
//
loadHistory();
</script>

</body>
</html>
